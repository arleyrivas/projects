<div class="wrapper">
  <mat-card>
    <mat-card-content>
        <div class="header">
            <svg class="icon-title" id="Capa_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64.84 70.61"><defs><style>.claseunounica{fill:none;stroke:#231f20;stroke-linecap:round;stroke-linejoin:round;stroke-width:.5px;}</style></defs><g id="Capa_1-2"><rect class="claseunounica" x=".25" y=".25" width="64.34" height="70.11"/><rect class="claseunounica" x="6.43" y="29.19" width="8.93" height="8.93"/><rect class="claseunounica" x="20.7" y="29.19" width="8.93" height="8.93"/><rect class="claseunounica" x="5.63" y="8.26" width="53.58" height="14.31"/><rect class="claseunounica" x="34.98" y="29.19" width="8.93" height="8.93"/><rect class="claseunounica" x="49.25" y="29.19" width="8.93" height="8.93"/><rect class="claseunounica" x="6.43" y="42.47" width="8.93" height="8.93"/><rect class="claseunounica" x="20.7" y="42.47" width="8.93" height="8.93"/><rect class="claseunounica" x="34.98" y="42.47" width="8.93" height="8.93"/><rect class="claseunounica" x="49.25" y="42.47" width="8.93" height="8.93"/><rect class="claseunounica" x="6.43" y="55.75" width="8.93" height="8.93"/><rect class="claseunounica" x="20.7" y="55.75" width="8.93" height="8.93"/><rect class="claseunounica" x="34.98" y="55.75" width="8.93" height="8.93"/><rect class="claseunounica" x="49.25" y="55.75" width="8.93" height="8.93"/><rect class="claseunounica" x="9.24" y="11.23" width="4.49" height="8.68"/><rect class="claseunounica" x="17.62" y="11.23" width="4.49" height="8.68"/><rect class="claseunounica" x="26" y="11.23" width="4.49" height="8.68"/><rect class="claseunounica" x="34.37" y="11.23" width="4.49" height="8.68"/><polyline class="claseunounica" points="42.75 16.02 47.24 11.23 47.24 19.9"/><polyline class="claseunounica" points="51.13 16.02 55.61 11.23 55.61 19.9"/></g></svg>
            <h2 class="title">Notas crédito</h2>
         </div>
    </mat-card-content>
  </mat-card>

  <div class="credit-notes">
    <mat-card>
      <mat-card-content>
        <div class="primary-panel">
          <ng-container>
            <div class="credit-notes__searcher">
              <ng-container *ngIf="userInfo">
                <ng-container *ngIf="userInfo.empresa">
                  <app-customer-searcher
                          class="credit-notes__customer-searcher"
                          [controlDisabled]="!isAgent"
                          [searcher]="isAgent"
                          [data]="userInfo.empresa.id + '/' + userInfo.userName"
                          (customerSearch)="customerSearch($event)"
                        >
                        </app-customer-searcher>

                        <button mat-mini-fab color="primary" (click)="selectCustomer()" [disabled]="!isAgent" class="credit-notes__search-button">
                          <mat-icon>search</mat-icon>
                        </button>
                </ng-container>
              </ng-container>
            </div>

            <mat-form-field class="queries__filter">
              <mat-label>Filtro</mat-label>
              <mat-icon matPrefix class="queries__filter-icon">search</mat-icon>
              <input matInput (keyup)="applyCreditNotesFilter($event)" placeholder="Ingrese valor para filtrar" #input>
            </mat-form-field>

            <ng-scrollbar class="table-container" (reachedBottom)="loadCreditNotes()">
              <table mat-table #creditNotesTable="matSort" [dataSource]="creditNotesDatasource" matSort>
                  <ng-container matColumnDef="creditNotesSelected">
                      <th mat-header-cell *matHeaderCellDef>
                          <mat-checkbox (change)="selectAllCreditNotes($event.checked)" color="primary"></mat-checkbox>
                      </th>
                      <td mat-cell *matCellDef="let element">
                          <mat-checkbox [checked]="element.selected" (change)="creditNotesCheckboxChange($event, element.final_nbr)" color="primary"></mat-checkbox>
                      </td>
                  </ng-container>
                <ng-container matColumnDef="final_nbr">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <ng-container i18n="@@acb5c3fc93d5bcbd210d277df148e20cba3cbcf4703537796dad20a5e560216b">
                      credit.notes.view.search.result.table.NBR
                    </ng-container>
                  </th>
                  <td mat-cell *matCellDef="let element">{{ element.final_nbr }}</td>
                </ng-container>

                <ng-container matColumnDef="finalized_date">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <ng-container i18n="@@63ad4c470833bf1f7886bccd5a52a33be7172c3e5fb7a10f0f8cafac15f38e16">
                      credit.notes.view.search.result.table.CREATED
                    </ng-container>
                  </th>
                  <td mat-cell *matCellDef="let element">{{ element.finalized_date | dateFormat:"classic" }}</td>
                </ng-container>

                <ng-container matColumnDef="TOTAL">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <ng-container i18n="@@896a19bebab3ca623b61382852b8730659e65dcc69e3f5028f4ce9ff91556b37">
                      credit.notes.view.search.result.table.AMOUNT
                    </ng-container>
                  </th>
                  <td mat-cell *matCellDef="let element">{{ element.TOTAL | number }}</td>
                </ng-container>

                <ng-container matColumnDef="CUSTDFF_BALANCECREDIT">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <ng-container i18n="@@4701819e476fc10db4334f505513a2cd32c463001eb422505cf07a3306c37467">
                      credit.notes.view.search.result.table.BALANCE
                    </ng-container>
                  </th>
                  <td mat-cell *matCellDef="let element">{{ element.CUSTDFF_BALANCECREDIT | number }}</td>
                </ng-container>

                <ng-container matColumnDef="Estado">
                  <th mat-header-cell *matHeaderCellDef>
                    <ng-container i18n="@@46a121441115d268386714b361a93fb05a0f83b913a73c23971488669a305587">
                      credit.notes.view.search.result.table.STATUS
                    </ng-container>
                  </th>
                  <td mat-cell *matCellDef="let element">{{ element.status_used | creditNotesState }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="creditNotesDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: creditNotesDisplayedColumns;"></tr>
              </table>
            </ng-scrollbar>

            <button
              mat-raised-button
              color="primary"
              class="export-button"
              (click)="exportAsPDF()"
              *permissions="[privileges.NOTA_CRED_DOWN]"
            >
              <svg class="download-invoices-icon" id="Capa_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70.83 76.22"><defs><style>.cls-1{fill:#92b976;}</style></defs><g id="Capa_1-2"><path class="cls-1" d="m0,56.89v16.69c0,1.46,1.18,2.64,2.64,2.64h65.55c1.46,0,2.64-1.19,2.64-2.64v-16.69c0-1.46-1.19-2.64-2.64-2.64h-6.45c-1.45,0-2.64,1.19-2.64,2.64v7.58H11.73v-7.58c0-1.46-1.18-2.64-2.64-2.64H2.64c-1.46,0-2.64,1.19-2.64,2.64Zm3.19.55h5.35v8.63c0,.88.71,1.59,1.6,1.59h50.56c.88,0,1.6-.71,1.6-1.59v-8.63h5.35v15.59H3.19v-15.59Z"/><path class="cls-1" d="m25.3,11.13h20.24c1.55,0,2.82-1.26,2.82-2.82V2.82c0-1.55-1.26-2.82-2.82-2.82h-20.24c-1.55,0-2.82,1.26-2.82,2.82v5.5c0,1.55,1.26,2.82,2.82,2.82Zm.38-7.94h19.49v4.75h-19.49V3.19Z"/><path class="cls-1" d="m22.32,26.29h-10.34c-1.7,0-3.18.82-3.77,2.09-.46,1.01-.3,2.13.45,3.01l11.72,13.74h0l11.72,13.74c.75.88,1.96,1.38,3.31,1.38h0c1.36,0,2.57-.5,3.32-1.38l23.44-27.48c.75-.88.92-2.01.45-3.01-.59-1.27-2.06-2.09-3.77-2.09h-10.7v-9.75c0-1.46-1.18-2.64-2.64-2.64h-20.57c-1.45,0-2.64,1.19-2.64,2.64v9.75Zm1.59,3.19c.88,0,1.6-.71,1.6-1.6v-10.8h19.47v10.8c0,.88.72,1.6,1.6,1.6h12.29c.28,0,.5.05.65.11l-23.2,27.2c-.09.11-.43.26-.89.26h0c-.46,0-.8-.15-.89-.26l-11.72-13.74h0l-11.48-13.46c.15-.06.37-.11.65-.11h11.94Z"/></g></svg>
              <span>Descargar Notas Créditos y Facturas</span>
          </button>
          </ng-container>
      </div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-content>
        <div class="secondary-panel">
          <mat-form-field class="queries__filter">
              <mat-label>Filtro</mat-label>
              <mat-icon matPrefix class="queries__filter-icon">search</mat-icon>
              <input matInput (keyup)="applyInvoiceFilter($event)" placeholder="Ingrese valor para filtrar" #input>
            </mat-form-field>

              <ng-scrollbar class="table-container" (reachedBottom)="loadInvoice()">
                <table mat-table #invoicesTable="matSort" [dataSource]="invoiceDatasource" matSort>
                  <ng-container matColumnDef="invoiceSelected">
                      <th mat-header-cell *matHeaderCellDef>
                          <mat-checkbox (change)="selectAllInvoices($event.checked)" color="primary"></mat-checkbox>
                      </th>
                      <td mat-cell *matCellDef="let element">
                          <mat-checkbox [checked]="element.selected" (change)="invoiceCheckboxChange($event, element.finalNumber)" color="primary"></mat-checkbox>
                      </td>
                  </ng-container>

                  <ng-container matColumnDef="finalNumber">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      <ng-container i18n="@@acb5c3fc93d5bcbd210d277df148e20cba3cbcf4703537796dad20a5e560216b">
                        credit.notes.view.search.result.table.NBR
                      </ng-container>
                    </th>
                    <td mat-cell *matCellDef="let element">{{ element.finalNumber }}</td>
                  </ng-container>

                  <ng-container matColumnDef="finalizedDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      <ng-container i18n="@@63ad4c470833bf1f7886bccd5a52a33be7172c3e5fb7a10f0f8cafac15f38e16">
                        credit.notes.view.search.result.table.CREATED
                      </ng-container>
                    </th>
                    <td mat-cell *matCellDef="let element">{{ element.finalizedDate | dateFormat:"classic"  }}</td>
                  </ng-container>

                  <ng-container matColumnDef="balance">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      <ng-container i18n="@@896a19bebab3ca623b61382852b8730659e65dcc69e3f5028f4ce9ff91556b37">
                        credit.notes.view.search.result.table.AMOUNT
                      </ng-container>
                    </th>
                    <td mat-cell *matCellDef="let element">{{ element.balance | number }}</td>
                  </ng-container>

                  <ng-container matColumnDef="bill">
                    <th mat-header-cell *matHeaderCellDef>Factura</th>
                    <td mat-cell *matCellDef="let element">
                      <div class="download-bill">
                        <svg (click)="downloadBill(element.finalNumber)" class="download-bill-icon" id="Capa_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 317.73 416.59"><defs><style>.claseunicadescarganotacredito{fill:#92b976;stroke-width:0px;}</style></defs><g id="Capa_1-2"><path class="claseunicadescarganotacredito" d="m311.94,85.43h-59.35c-11.18,0-20.28-9.1-20.28-20.28V5.79c0-3.2,2.59-5.79,5.79-5.79s5.79,2.59,5.79,5.79v59.35c0,4.79,3.9,8.7,8.69,8.7h59.35c3.2,0,5.79,2.59,5.79,5.79s-2.59,5.79-5.79,5.79Z"/><path class="claseunicadescarganotacredito" d="m258.77,65.47h51.03L251.86,7.53v51.03c0,3.81,3.1,6.91,6.91,6.91Z"/><path class="claseunicadescarganotacredito" d="m258.77,81.8c-12.82,0-23.24-10.43-23.24-23.24V1.93H14.49C6.49,1.93,0,8.42,0,16.42v385.69c0,8,6.49,14.49,14.49,14.49h286.83c8,0,14.49-6.49,14.49-14.49V81.8h-57.03ZM37.65,55.25h170.95c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12Zm240.49,288.74H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Zm0-46.08H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Zm0-46.08H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Zm0-46.08H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Zm0-46.08H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Zm0-46.08H37.65c-3.38,0-6.12-2.74-6.12-6.12s2.74-6.12,6.12-6.12h240.49c3.38,0,6.12,2.74,6.12,6.12s-2.74,6.12-6.12,6.12Z"/></g></svg>
                      </div>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="invoiceDisplayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: invoiceDisplayedColumns;"></tr>
                </table>
            </ng-scrollbar>

          <div class="cross-operation">
              <div class="operations">
                  <div class="selected-items">
                      <span class="selected-title">
                        Notas credito seleccionadas
                      </span>
                      <div class="selected-list-scroll">
                          <ul class="selected-list">
                              <li class="selected-list-item" *ngFor="let cross of selectedCreditNotes">{{ cross.final_nbr }}</li>
                          </ul>
                      </div>
                  </div>
                  <div class="selected-items">
                      <span class="selected-title">
                        Total Notas credito a cruzar
                      </span>
                      <div class="selected-total">{{ creditNotesTotal | number }}</div>
                  </div>
              </div>

            <svg class="credit-notes-cross-principal-icon" id="Capa_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 433.2 216.62"><defs><style>.claseunicaaaaaaaaaaaaa1{fill-rule:evenodd;}.claseunicaaaaaaaaaaaaa1,.claseunicaaaaaaaaaaaaa2{fill:#92b976;stroke-width:0px;}</style></defs><g id="Capa_1-2"><path class="claseunicaaaaaaaaaaaaa2" d="m17.95,185.84c-9.91,0-17.95-8.04-17.95-17.95s8.04-17.95,17.95-17.95h106.08l103.96-113.33c3.53-3.84,8.35-5.78,13.18-5.78v-.04h113.92c9.91,0,17.95,8.04,17.95,17.95s-8.04,17.95-17.95,17.95h-106.08l-103.18,112.48c-3.29,4.07-8.32,6.67-13.96,6.67H17.95Z"/><polygon class="claseunicaaaaaaaaaaaaa1" points="355.09 119.15 433.2 167.88 355.09 216.62 355.09 119.15"/><polygon class="claseunicaaaaaaaaaaaaa1" points="355.09 0 433.2 48.73 355.09 97.47 355.09 0"/><path class="claseunicaaaaaaaaaaaaa2" d="m17.95,66.69c-9.91,0-17.95-8.04-17.95-17.95s8.04-17.95,17.95-17.95h113.92c5.64,0,10.67,2.6,13.96,6.67l103.18,112.48h106.08c9.91,0,17.95,8.04,17.95,17.95s-8.04,17.95-17.95,17.95h-113.92v-.04c-4.83,0-9.65-1.95-13.18-5.78l-103.96-113.33H17.95Z"/></g></svg>

            <div class="operations">
                <div class="selected-items">
                    <span class="selected-title">
                      Facturas seleccionadas
                    </span>
                    <div class="selected-list-scroll">
                        <ul class="selected-list">
                            <li class="selected-list-item" *ngFor="let cross of selectedInvoices">{{ cross.finalNumber }}</li>
                        </ul>
                    </div>
                </div>

                <div class="selected-items">
                    <span class="selected-title">
                      Total Facturas a pagar
                    </span>
                    <div class="selected-total">{{ invoicesTotal | number}}</div>
                </div>
            </div>
          </div>

          <div class="actions">
              <button mat-flat-button class="cancel-button" (click)="cancel()">
                <ng-container i18n="@@3dabe66ad8781ee906d54cd2c1295152c8491ce9efdb751a18dd22d308e78d1b">
                  credit.notes.views.actions.button.CANCEL
                </ng-container>
              </button>

              <button mat-raised-button color="primary" class="cross-button" (click)="cross()" *permissions="[privileges.NOTA_CRUZAR_FACT]" [disabled]="!selectedCreditNotes.length || !selectedInvoices.length">
                <svg class="cross-button-icon" id="Capa_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 433.2 216.62"><defs><style>.cls-1{fill-rule:evenodd;}.cls-1,.cls-2{fill:#ffffff;stroke-width:0px;}</style></defs><g id="Capa_1-2"><path class="cls-2" d="m17.95,185.84c-9.91,0-17.95-8.04-17.95-17.95s8.04-17.95,17.95-17.95h106.08l103.96-113.33c3.53-3.84,8.35-5.78,13.18-5.78v-.04h113.92c9.91,0,17.95,8.04,17.95,17.95s-8.04,17.95-17.95,17.95h-106.08l-103.18,112.48c-3.29,4.07-8.32,6.67-13.96,6.67H17.95Z"/><polygon class="cls-1" points="355.09 119.15 433.2 167.88 355.09 216.62 355.09 119.15"/><polygon class="cls-1" points="355.09 0 433.2 48.73 355.09 97.47 355.09 0"/><path class="cls-2" d="m17.95,66.69c-9.91,0-17.95-8.04-17.95-17.95s8.04-17.95,17.95-17.95h113.92c5.64,0,10.67,2.6,13.96,6.67l103.18,112.48h106.08c9.91,0,17.95,8.04,17.95,17.95s-8.04,17.95-17.95,17.95h-113.92v-.04c-4.83,0-9.65-1.95-13.18-5.78l-103.96-113.33H17.95Z"/></g></svg>
                <span>
                  <ng-container i18n="@@8b8432fb731ce3940cd6eee31bc00d16b1bcff3e0a2e786c8647f804cca6dd6f">
                    credit.notes.views.actions.button.MERGE
                  </ng-container>
                </span>
              </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

</div>
